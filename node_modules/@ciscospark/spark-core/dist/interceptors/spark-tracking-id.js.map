{"version":3,"sources":["../../src/interceptors/spark-tracking-id.js"],"names":["sequenceNumbers","SparkTrackingIdInterceptor","options","headers","requiresTrackingId","trackingid","spark","sessionId","sequence","sq","get","set"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMA;;;;AAEA,IAAMA,kBAAkB,uBAAxB;;AAEA;;;AAVA;;;;;;IAaqBC,0B;;;;;;;;;;;;AAmBnB;;;;;8BAKUC,O,EAAS;AACjBA,cAAQC,OAAR,GAAkBD,QAAQC,OAAR,IAAmB,EAArC;AACA,UAAI,KAAKC,kBAAL,CAAwBF,OAAxB,CAAJ,EAAsC;AACpCA,gBAAQC,OAAR,CAAgBE,UAAhB,GAAgC,KAAKC,KAAL,CAAWC,SAA3C,SAAwD,KAAKC,QAA7D;AACD;AACD,aAAON,OAAP;AACD;;AAED;;;;;;;;uCAKmBA,O,EAAS;AAC1B,aAAO,CAACA,QAAQC,OAAR,CAAgBE,UAAxB;AACD;;;;AAtCD;;;;wBAIe;AACb,UAAII,KAAKT,gBAAgBU,GAAhB,CAAoB,IAApB,KAA6B,CAAtC;AACAD,YAAM,CAAN;AACAT,sBAAgBW,GAAhB,CAAoB,IAApB,EAA0BF,EAA1B;AACA,aAAOA,EAAP;AACD;;AAED;;;;;;6BAGgB;AACd,aAAO,IAAIR,0BAAJ,CAA+B,EAACK,OAAO,IAAR,EAA/B,CAAP;AACD;;;;;kBAjBkBL,0B","file":"spark-tracking-id.js","sourcesContent":["/**!\n *\n * Copyright (c) 2015 Cisco Systems, Inc. See LICENSE file.\n * @private\n */\n\nimport {Interceptor} from '@ciscospark/http-core';\n\nconst sequenceNumbers = new WeakMap();\n\n/**\n * @class\n */\nexport default class SparkTrackingIdInterceptor extends Interceptor {\n  /**\n   * Sequence number; increments on access\n   * @type {Number}\n   */\n  get sequence() {\n    let sq = sequenceNumbers.get(this) || 0;\n    sq += 1;\n    sequenceNumbers.set(this, sq);\n    return sq;\n  }\n\n  /**\n   * @returns {SparkTrackingIdInterceptor}\n   */\n  static create() {\n    return new SparkTrackingIdInterceptor({spark: this});\n  }\n\n  /**\n   * @see Interceptor#onRequest\n   * @param {Object} options\n   * @returns {Object}\n   */\n  onRequest(options) {\n    options.headers = options.headers || {};\n    if (this.requiresTrackingId(options)) {\n      options.headers.trackingid = `${this.spark.sessionId}_${this.sequence}`;\n    }\n    return options;\n  }\n\n  /**\n   * Determines whether or not include a tracking id\n   * @param {Object} options\n   * @returns {boolean}\n   */\n  requiresTrackingId(options) {\n    return !options.headers.trackingid;\n  }\n}\n"]}